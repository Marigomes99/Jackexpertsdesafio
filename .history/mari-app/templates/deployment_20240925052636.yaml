apiVersion: apps/v1
kind: Deployment
metadata:
  name: mari-app
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: mari-app  
  template:
    metadata:
      labels:
        app: mari-app
    spec:
      imagePullSecrets:
        - name: meu-secret-docker  # Adicionando o secret
      containers:
        - name: mari-app
          image: {{ .Values.image.repository }}:{{ .Values.image.tag }}
          ports:
            - containerPort: 3001  # A porta que o container vai escutar
          env:
            - name: PAGE_CONTENT
              value: {{ .Values.config.pageContent | quote }}
            - name: USER_NAME
              value: {{ .Values.config.userName | quote }}

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: mari-app-ingress
  namespace: ingress-nginx  # Certifique-se de que isso está correto
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
    - host: desafiojackexpertsmari.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: mari-app
                port:
                  number: 3001  # A porta do serviço correspondente

---
apiVersion: v1
kind: Service
metadata:
  name: mari-app
  labels:
    app: mari-app
spec:
  type: {{ .Values.service.type }}  # Tipo do serviço, por exemplo, LoadBalancer
  ports:
    - port: 3001  # Porta exposta pelo serviço
      targetPort: 3001  # Porta onde o aplicativo está escutando dentro do pod
      protocol: TCP
  selector:
    app: mari-app  # Seleciona os pods que correspondem ao label 'app: mari-app'
